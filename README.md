# Moscow State University - SQL

1. В базе данных веб-сайта StackOverflow хранятся вопросы и ответы на них. Каждому вопросу может соответствовать ноль или более ответов, но только один ответ может быть отмечен как верный. Опишите нормализованную структуру таблиц реляционной базы данных, указав первичные и внешние ключи, атрибуты и их типы данных. Результат оформите в виде ER-схемы в Oracle SQL Developer или любом другом редакторе.
2. Напишите SQL запросы для выборки следующих данных (по 1 запросу на каждый пункт задания):
* Выбрать все заказы (SALES_ORDER)
* Выбрать все заказы, введенные после 1 января 2016 года
* Выбрать все заказы, введенные после 1 января 2016 года и до 15 июля 2016 года
* Найти менеджеров с именем 'Henry'
* Выбрать все заказы менеджеров с именем Henry
* Выбрать все уникальные страны из таблицы CITY
* Выбрать все уникальные комбинации страны и региона из таблицы CITY
* Выбрать все страны из таблицы CITY с количеством городов в них.
* Выбрать количество товаров (QTY), проданное с 1 по 30 января 2016 года.
* Выбрать все уникальные названия городов, регионов и стран в одной колонке
* Вывести имена и фамилии менеджер(ов), продавшего товаров в январе 2016 года на наибольшую сумму.
3. Реализовать запрос с использованием аналитических возможностей языка SQL на основе данных из представления V_FACT_SALE:
* Каждый месяц компания выдает премию в размере 5% от суммы продаж менеджеру, который за предыдущие 3 месяца продал товаров на самую большую сумму. Выведите месяц, manager_id, manager_first_name, manager_last_name, премию за период с января по декабрь 2014 года
* Компания хочет оптимизировать количество офисов, проанализировав относительные объемы продаж по офисам в течение периода с 2013-2014 гг. Выведите год, office_id, city_name, country, относительный объем продаж за текущий год. Офисы, которые демонстрируют наименьший относительной объем в течение двух лет скорее всего будут закрыты.
* Для планирования закупок, компанию оценивает динамику роста продаж по товарам. Динамика оценивается как отношение объема продаж в текущем месяце к предыдущему. Выведите товары, которые демонстрировали наиболее высокие темпы роста продаж в течение первого полугодия 2014 года.
* Напишите запрос, который выводит отчет о прибыли компании за 2014 год: помесячно и поквартально. Отчет включает сумму прибыли за период и накопительную сумму прибыли с начала года по текущий период.
* Найдите вклад в общую прибыль за 2014 год 10% наиболее дорогих товаров и 10% наиболее дешевых товаров. Выведите product_id, product_name, total_sale_amount, percent
* Компания хочет премировать трех наиболее продуктивных (по объему продаж, конечно) менеджеров в каждой стране в 2014 году. Выведите country, <список manager_last_name manager_first_name, разделенный запятыми> которым будет выплачена премия
* Выведите самый дешевый и самый дорогой товар, проданный за каждый месяц в течение 2014 года. cheapest_product_id, cheapest_product_name, expensive_product_id, expensive_product_name, month, cheapest_price, expensive_price
* Менеджер получает оклад в 30 000 + 5% от суммы своих продаж в месяц. Средняя наценка стоимости товара - 10%. Посчитайте прибыль предприятия за 2014 год по месяцам (сумма продаж - (исходная стоимость товаров + зарплата)) month, sales_amount, salary_amount, profit_amount
4. Используя таблицу FILE_SYSTEM реализовать следующие запросы (каждый следующий запрос основан на предыдущем).
* Вывести все директории в виде: ID, Название, Путь до корня
* Для каждой директории посчитать объем занимаемого места на диске (с учетом всех вложенных папок) ID, Название, Путь до корня, total_size
* Добавить в запрос: сколько процентов директория занимает  места относительно всех среди своих соседей (siblings) ID, Название, Путь до корня, total_size, ratio
